<p-toast />
<div class="main">

    <div class="byDay">
        <h1>Hôm nay</h1>
        <div class="today">
            <div class="card todayRevenue">
                <h2>Doanh Thu</h2>
                <div class="infor">
                    <i class="pi pi-dollar"></i>
                    <p>{{ businessDataToDay?.total_revenue || 0 | number:'1.0-0'}}₫</p>
                </div>
            </div>

            <div class="card todayOrders">
                <h2>Số Đơn Hàng</h2>
                <div class="infor">
                    <i class="pi pi-shopping-cart"></i>
                    <p>{{ businessDataToDay?.total_orders || 0 | number:'1.0-0'}}</p>
                </div>
            </div>

            <div class="card todayHotItem">
                <h2>Món Bán Chạy Nhất</h2>
                <div class="infor">
                    <img [src]="urlBackend + businessDataToDay?.image_url" alt="">
                    <p>{{ businessDataToDay?.menu_name || 'Chưa có dữ liệu' }}</p>
                </div>
            </div>
        </div>
    </div>

    <div class="byMonth">
        <h1>Tháng Này</h1>

        <div class="fillter">
            <div class="filterTime">
                <h2>Tháng/Năm</h2>
                <div class="card flex justify-center">
                    <p-datepicker [(ngModel)]="selectedDate" view="month" dateFormat="mm/yy" [readonlyInput]="true"
                        (ngModelChange)="loadData()" />
                </div>
            </div>

            <div class="btnExpense">
                <p-button label="Chi Phí" icon="pi pi-plus" [size]="'small'"
                    (click)="viewAddExpense = !viewAddExpense"></p-button>

                <p-dialog header="Chi phí" [(visible)]="viewAddExpense" [modal]="true" [style]="{ width: '60vw' }"
                    *ngFor="let item of businessDataNowMonth" [draggable]="false" [resizable]="false">
                    <div class="expense-form">
                        <div class="p-fluid form-grid">
                            <div class="p-field">
                                <label for="staff_salary">Lương nhân viên:</label>
                                <p-inputNumber inputId="staff_salary" [(ngModel)]="item.staff_salary"
                                    name="staff_salary" mode="currency" currency="VND" locale="vi-VN" [min]="0"
                                    required>
                                </p-inputNumber>
                            </div>

                            <div class="p-field">
                                <label for="eletricity_bill">Tiền điện:</label>
                                <p-inputNumber inputId="eletricity_bill" [(ngModel)]="item.eletricity_bill"
                                    name="eletricity_bill" mode="currency" currency="VND" locale="vi-VN" [min]="0"
                                    required>
                                </p-inputNumber>
                            </div>

                            <div class="p-field">
                                <label for="water_bill">Tiền nước:</label>
                                <p-inputNumber inputId="water_bill" [(ngModel)]="item.water_bill" name="water_bill"
                                    mode="currency" currency="VND" locale="vi-VN" [min]="0" required>
                                </p-inputNumber>
                            </div>

                            <div class="p-field">
                                <label for="rent">Mặt bằng:</label>
                                <p-inputNumber inputId="rent" [(ngModel)]="item.rent" name="rent" mode="currency"
                                    currency="VND" locale="vi-VN" [min]="0" required>
                                </p-inputNumber>
                            </div>

                            <div class="p-field">
                                <label for="other">Chi phí khác:</label>
                                <p-inputNumber inputId="other" [(ngModel)]="item.other" name="other" mode="currency"
                                    currency="VND" locale="vi-VN" [min]="0" required>
                                </p-inputNumber>
                            </div>
                        </div>

                        <div class="dialog-footer">
                            <p-button label="Cập nhật" icon="pi pi-save" (click)="updateBusiness(item)"
                                styleClass="p-button-sm p-button-success">
                            </p-button>
                        </div>
                    </div>
                </p-dialog>


            </div>
        </div>
        <div class="overView" *ngFor="let item of businessDataNowMonth">
            <div class="card doanhThu">
                <h1>Doanh Thu</h1>
                <div class="infor">
                    <i class="pi pi-dollar"></i>
                    <p>{{ item.revenue || 0 | number:'1.0-0'}}₫</p>
                    <span class="predict">{{predictData?.predicted_revenue || 0 | number:'1.0-0'}}₫</span>
                </div>
            </div>

            <div class="card loiNhuan">
                <h1>Lợi Nhuận</h1>
                <div class="infor">
                    <i class="pi pi-wallet"></i>
                    <p>{{ item.net_profit || 0 | number:'1.0-0'}}₫</p>
                    <span class="predict">{{predictData?.predicted_profit || 0 | number:'1.0-0'}}₫</span>
                </div>
            </div>

            <div class="card tiLeLoiNhuan">
                <h1>Tỉ lệ Lợi Nhuận</h1>
                <div class="infor">
                    <i class="pi pi-percentage"></i>
                    <p>{{ item.net_profit/item.revenue || 0 | number:'1.0-1'}}%</p>
                </div>
            </div>

            <div class="card soDonHang">
                <h1>Số Đơn Hàng</h1>
                <div class="infor">
                    <i class="pi pi-shopping-cart"></i>
                    <p>{{ item.total_order || 0 | number:'1.0-0'}}</p>
                    <span class="predict">{{ predictData?.predicted_total_order || 0 | number:'1.0-0'}}</span>
                </div>
            </div>


        </div>

        <div class="chars">
            <div class="chart charRevenue">
                <p>Doanh thu - Lợi nhuận từng tháng</p>
                <div class="card">
                    <p-chart type="line" [data]="data" [options]="options" class="h-[30rem]" />
                </div>
            </div>

            <div class="chart charPie">
                <p>Doanh thu theo danh mục sản phẩm</p>
                <div class="card flex justify-center">
                    <p-chart type="pie" [data]="dataPie" [options]="optionsPie" class="w-full md:w-[30rem]" />
                </div>
            </div>
        </div>

        <div class="product">
            <div class="line"></div>
            <h1>Sản phẩm</h1>

            <div class="card">
                <p-chart type="bar" [data]="dataProduct" [options]="optionsProduct" class="h-[30rem]" />
            </div>
        </div>
    </div>



</div>